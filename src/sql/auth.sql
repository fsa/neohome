CREATE TABLE oauth_clients (
    uuid uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    client_id varchar NOT NULL UNIQUE,
    client_secret varchar NOT NULL,
    redirect_uris varchar[],
    description varchar
);
COMMENT ON TABLE oauth_clients IS 'Клиенты сервера OAuth 2.0';

CREATE TABLE oauth_tokens (
    code varchar NOT NULL UNIQUE,
    access_token varchar UNIQUE,
    token_expires_on timestamptz,
    refresh_token varchar UNIQUE,
    client_uuid uuid REFERENCES oauth_clients (uuid),
    user_uuid uuid REFERENCES users (uuid),
    scope text[],
    created timestamptz NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated timestamptz NOT NULL DEFAULT CURRENT_TIMESTAMP
);
COMMENT ON TABLE oauth_tokens IS 'Токены OAuth 2.0';


CREATE TABLE auth_fail2ban (
    id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    login varchar(32) NOT NULL,
    ip inet NOT NULL,
    fail_time timestamptz NOT NULL
);
CREATE INDEX auth_fail2ban_login_idx ON auth_fail2ban (login);
CREATE INDEX auth_fail2ban_fail_time_idx ON auth_fail2ban (fail_time);
COMMENT ON TABLE auth_fail2ban IS 'Данные об ошибках аутентификации';