CREATE TABLE devices (
    uid varchar NOT NULL UNIQUE,
    description text,
    plugin varchar NOT NULL,
    hwid varchar NOT NULL,
    class varchar NOT NULL,
    properties jsonb,
);
COMMENT ON TABLE devices IS 'Физические устройства';

CREATE TABLE sensors (
    id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    uid varchar NOT NULL UNIQUE,
    description text,
    property varchar NOT NULL,
    device_property varchar UNIQUE,
    history varchar
);
COMMENT ON TABLE sensors IS 'Датчики';

CREATE TABLE history_meters (
    id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    sensor_id bigint REFERENCES sensors(id),
    value float NOT NULL,
    timestamp timestamptz DEFAULT CURRENT_TIMESTAMP
);
COMMENT ON TABLE history_meters IS 'Журнал измерений';
CREATE INDEX "history_meters_timestamp" ON "meter_history" ("timestamp");

-- История срабатывания датчиков сигнализации устройств
CREATE TABLE history_indicators (
    id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    sensor_id bigint REFERENCES indicators(id),
    value boolean NOT NULL,
    timestamp timestamptz DEFAULT CURRENT_TIMESTAMP
);
COMMENT ON TABLE history_indicators IS 'Журнал контрольных датчиков';
CREATE INDEX "history_indicators_timestamp" ON "indicator_history" ("timestamp");
